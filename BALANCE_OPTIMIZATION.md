# Оптимизация обновления баланса

## Проблема
Ранее баланс обновлялся каждые 30 секунд в `useBalance.ts` и каждые 10 секунд в `useBalanceWebSocket.ts`, что создавало избыточные запросы к API и ухудшало производительность.

## Решение

### 1. Кэширование баланса
- Добавлено кэширование баланса в `localStorage` с временем жизни 5 минут
- Баланс загружается из кэша, если он актуален
- Кэш обновляется при каждом успешном запросе

### 2. Умное обновление
- Создан новый хук `useSmartBalance` для интеллектуального обновления
- Баланс обновляется только при необходимости:
  - При фокусе на окне (пользователь возвращается на вкладку)
  - При изменении видимости страницы
  - При обновлении в других вкладках
  - При принудительном обновлении

### 3. Минимальный интервал между обновлениями
- Установлен минимальный интервал в 1 минуту между обновлениями
- Предотвращает избыточные запросы при быстром переключении между вкладками

### 4. Компонент для принудительного обновления
- Создан `BalanceRefreshButton` для ручного обновления баланса
- Показывает состояние загрузки
- Можно использовать в любом месте приложения

## Преимущества

1. **Производительность**: Значительно меньше запросов к API
2. **Пользовательский опыт**: Баланс обновляется когда это действительно нужно
3. **Экономия ресурсов**: Меньше нагрузки на сервер и клиент
4. **Кэширование**: Быстрая загрузка баланса из локального кэша

## Использование

```tsx
import { BalanceRefreshButton } from '@/components/BalanceRefreshButton'

// В любом компоненте
<BalanceRefreshButton showText={true} />
```

## Настройка

В `useSmartBalance` можно настроить параметры:

```tsx
const { smartRefresh } = useSmartBalance({
  updateOnFocus: true,        // Обновлять при фокусе
  updateOnVisibility: true,   // Обновлять при видимости
  minUpdateInterval: 60000    // Минимальный интервал (мс)
})
```
